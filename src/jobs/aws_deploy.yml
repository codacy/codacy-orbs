description: "A shell deploy command to be executed with AWS credentials on the aws executor"

parameters:
  cmd:
    description: "The command to run"
    type: string
  aws_profile:
    description: "The AWS profile to use"
    type: string
    default: "default"
  region:
    description: "The AWS region where to deploy"
    type: string
    default: eu-west-1
  working_directory:
    type: string
    default: "~/workdir"
    description: Overrides the default working_directory.

executor:
  name: aws
  working_directory: <<parameters.working_directory>>

environment:
  AWS_PROFILE: << parameters.aws_profile >>
  AWS_DEFAULT_REGION: << parameters.region >>

steps:
  - attach_workspace:
      at: <<parameters.working_directory>>

  - run_aws:
      cmd_name: AWS deploy command - << parameters.cmd >>
      deploy: true
      cmd: << parameters.cmd >>
