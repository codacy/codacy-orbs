description: Tag the version in the VCS provider

parameters:
  version:
    description: "The command to run"
    type: string
    default: "$(cat .version)"
  force:
    description: "Use force to override versions"
    type: boolean
    default: false

executor: machine

steps:
  - attach_workspace:
      at: ~/workdir
  - add_ssh_keys:
      fingerprints:
        - "df:83:d7:c7:d5:79:06:c2:3b:d1:fd:e2:a3:d1:12:c5"
  - run:
      name: Tag
      command: git fetch --tags
  - when:
      condition: << parameters.force >>
      steps:
        - deploy:
            name: Tag
            command: git tag --force << parameters.version >> && git push --force --tags
  - unless:
      condition: << parameters.force >>
      steps:
        - deploy:
            name: Tag
            command: git tag --force << parameters.version >> && git push --force-with-lease --tags
