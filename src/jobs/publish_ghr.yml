description: Publish Release on Github

parameters:
  path:
    type: string
    description: Path to the artifacts folder
  working_directory:
    type: string
    default: "~/workdir"
    description: Overrides the default working_directory.

executor:
  name: github
  working_directory: <<parameters.working_directory>>

steps:
  - attach_workspace:
      at: ./
  - run:
      name: Publish Release on Github
      command: |
        GHR_FLAGS=""
        if [ "${CIRCLE_BRANCH}" != "master" ]; then
          GHR_FLAGS+="-prerelease"
        fi
        ghr -t ${GITHUB_TOKEN} -u ${CIRCLE_PROJECT_USERNAME} -r ${CIRCLE_PROJECT_REPONAME} -c ${CIRCLE_SHA1} ${GHR_FLAGS} -delete $(cat .version) << parameters.path >>
