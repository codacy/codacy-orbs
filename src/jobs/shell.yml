description: "A default job executed in the shell"

parameters:
  cmd:
    description: "The command to run"
    type: string
  persist_to_workspace:
    description: "Whether to persist the workspace or not at the end of the job"
    type: boolean
    default: false
  working_directory:
    type: string
    default: "~/workdir"
    description: Overrides the default working_directory.

executor:
  name: machine
  working_directory: <<parameters.working_directory>>

steps:
  - attach_workspace:
      at: <<parameters.working_directory>>
  - run:
      name: Shell command - << parameters.cmd >>
      command: << parameters.cmd >>
  - when:
      condition: << parameters.persist_to_workspace >>
      steps:
        - persist_to_workspace:
            root: <<parameters.working_directory>>
            paths:
              - '*'
