description: Checkout and write the version file

parameters:
  write_sbt_version:
    description: If a version.sbt file should be written after version is generated
    type: boolean
    default: false
  update_submodules:
    type: boolean
    default: false
    description: Updates git submodules if true
  dev_branch:
    type: string
    default: "dev"
    description: Overrides the default dev branch (dev).
  release_branch:
    type: string
    default: "master"
    description: Overrides the default release branch (master).

executor: versioning

steps:
  - checkout

  - run:
      name: Set version
      command: /bin/git-version --dev-branch=<<parameters.dev_branch>> --release-branch=<<parameters.release_branch>> > .version

  - run:
      name: Current version
      command: cat .version

  - when:
      condition: <<parameters.write_sbt_version>>
      steps:
        - run:
            name: Set SBT version
            command: echo "version in ThisBuild := \"$(cat .version)\"" > version.sbt

  - when:
      condition: <<parameters.update_submodules>>
      steps:
        - run:
            name: Update git submodules
            command: git submodule update --init --recursive

  - persist_to_workspace:
      root: ~/workdir
      paths:
        - '*'
