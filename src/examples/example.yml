description: An example on how to use the defined jobs

usage:
  version: 2.1
  orbs:
    codacy: codacy/base@dev:alpha

  workflows:
    example:
      jobs:

        - codacy/checkout_and_version:
            write_sbt_version: true

        - codacy/sbt:
            name: test
            install_sbt_version: 1.3.0
            cmd: sbt ;coverage;test;coverageReport;coverageAggregate;codacyCoverage
            persist_to_workspace: true
            requires:
              - codacy/checkout_and_version

        - codacy/shell:
            name: deploy
            cmd: make deploy
            requires:
              - test

        - codacy/tag_version:
            name: tag_version
            context: CodacyAWS
            requires:
              - deploy

        - codacy/helm_aws:
            name: helm_lint
            cmd: helm lint .helm/some_app
            requires:
              - tag_version

        - codacy/helm_push:
            name: helm_push
            context: CodacyHelm
            chart_name: some_app
            requires:
              - helm_lint

        - codacy/helm_aws:
            name: helm_deploy_to_aws_integration
            use_cluster: true
            aws_profile: integration
            cluster_name: my-cluster-name
            context: CodacyAWS
            requires:
              - helm_push
            cmd: make -C .aws/ all VERSION=$(cat .version)

        - codacy/microk8s_install:
            name: k8s_1_15
            requires:
              - helm_deploy_to_aws_integration
        - codacy/microk8s_install:
            name: k8s_1_14
            microk8s_channel: "1.14/stable"
            requires:
              - helm_deploy_to_aws_integration
        - codacy/microk8s_install:
            name: k8s_1_13
            microk8s_channel: "1.13/stable"
            requires:
              - helm_deploy_to_aws_integration