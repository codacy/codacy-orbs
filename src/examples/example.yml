description: An example on how to use the defined jobs

usage:
  version: 2.1
  orbs:
    codacy: codacy/base@dev:alpha

  workflows:
    example:
      jobs:

        - codacy/checkout_and_version:
            write_sbt_version: true

        - codacy/sbt:
            name: test
            install_sbt_version: 1.3.0
            cmd: sbt ;coverage;test;coverageReport;coverageAggregate;codacyCoverage
            persist_to_workspace: true
            requires:
              - codacy/checkout_and_version

        - codacy/shell:
            name: deploy
            cmd: make deploy
            requires:
              - test

        - codacy/tag_version:
            name: tag_version
            context: CodacyAWS
            requires:
              - deploy

        - codacy/helm_aws:
            name: helm_lint
            cmd: helm lint .helm/some_app
            requires:
              - tag_version

        - codacy/helm_push:
            name: helm_push
            context: CodacyHelm
            chart_name: some_app
            requires:
              - helm_lint

        - codacy/helm_aws:
            name: helm_deploy_to_aws_integration
            use_cluster: true
            aws_profile: integration
            cluster_name: my-cluster-name
            context: CodacyAWS
            requires:
              - helm_push
            cmd: make -C .aws/ all VERSION=$(cat .version)

        - codacy/microk8s_install:
            # simple install from chart source using defaults
            name: install_micork8s
            requires:
              - helm_deploy_to_aws_integration
        - codacy/microk8s_install:
            # install a given feature branch from chart source
            # using selected versions for microk8s and helm
            name: install_micork8s_versions
            microk8s_channel: "1.14/stable"
            helm_version: "v2.16.1"
            chart_branch: "my-feature-branch"
            requires:
              - helm_deploy_to_aws_integration
        - codacy/microk8s_install:
            # install the latest published chart, skip waiting for all pods to be ready
            name: install_micork8s_latest_published
            use_chart_source: false
            wait_ready: false
            requires:
              - helm_deploy_to_aws_integration
        - codacy/microk8s_install:
            # install a given published chart
            name: install_micork8s_chart_version
            # by default the stable charts repo is used, if you want another one set it using, for instance
            # codacy_helm_repo_name: codacy-incubator
            codacy_version: "0.4.0"
            use_chart_source: false
            requires:
              - helm_deploy_to_aws_integration
